<!DOCTYPE html>

<html>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js" type="text/javascript"></script>

<head>
    <script>
        async function loadModel() {
            model = undefined;
            model = await tf.loadLayersModel("https://raw.githubusercontent.com/AA760/TFJS-AbusiveTextClassifier/main/model.json");
            console.log("Model loaded.")
        }
        loadModel();

        async function loadIndex() {
            wordIndex = undefined;
            const response = await fetch('https://raw.githubusercontent.com/AA760/TFJS-AbusiveTextClassifier/main/tokenizer.json');
            wordIndex = await response.json();
            console.log(wordIndex)
        }
        loadIndex()

        function getByValue(map, searchValue) {
             for (let [key, value] of map.entries()) {
                 if (value === searchValue)
                 return key;
             }
        }
        
        const findKey = (obj, val) => {
            const res = {};
             Object.keys(obj).map(key => {
                 res[obj[key]] = key;
        });
        // if the value is not present in the object
        // return false
        return res[val] || false;
        };
 

        function make_prediction() {
            

            let wordIndexMap = new Map(Object.entries(wordIndex));

            console.log(findKey(wordIndexMap, 110));

            var input, output;
            //input = Number(document.getElementById("input_text").value);
            inputT = tf.tensor2d([[7,353,366,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]);
            output = model.predict(inputT);
            const outputData = output.dataSync();
            document.getElementById("toxic").value = Number(outputData[0] > 0.5);
            document.getElementById("severe_toxic").value = Number(outputData[1] > 0.5);
            document.getElementById("obscene").value = Number(outputData[2] > 0.5);
            document.getElementById("threat").value = Number(outputData[3] > 0.5);
            document.getElementById("insult").value = Number(outputData[4] > 0.5);
            document.getElementById("identity_hate").value = Number(outputData[5] > 0.5);

        }
    </script>
</head>
<body>

    <p> <center> Abusive text classifier </center> </p> 
    <br>
    <center>Toxic</center>
    <center><input id="toxic"></center>
    <br><br>
    <center>Severe toxic</center>
    <center><input id="severe_toxic"></center>
    <br><br>
    <center>Obscene</center>
    <center><input id="obscene"></center>
    <br><br>
    <center>Threat</center>
    <center><input id="threat"></center>
    <br><br>
    <center>Insult</center>
    <center><input id="insult"></center>
    <br><br>
    <center>Identity hate</center>
    <center><input id="identity_hate"> 
    <br><br>
    <br><br>
    <br><br>
    <center> Enter text here: <input id="input_text"></center>
    <br><br>
    <center><button onclick="make_prediction()">Classify</button></center>
    <br><br>
</body>
</html>
